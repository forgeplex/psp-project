# ADR-023: 风控服务 Fail-Open/Fail-Closed 策略

## 状态

- 状态: 已确认 ✅
- 日期: 2026-02-03
- 决策人: Arch (架构师)

## 背景

在数据库清理过程中，需要明确风控服务（Risk Service）的架构策略：
1. 风控服务是否是必需的？
2. 风控服务故障时应该如何处理？

## 决策

### 1. 风控服务是必需的，不能移除

**原因:**
- 支付系统合规要求（PCI-DSS、AML/CFT）
- 核心安全功能：
  - IP 黑名单
  - 交易风控
  - AML 筛查

### 2. 采用"分层 Fail-Closed，场景化降级"策略

| 规则层级 | 故障处理策略 | 说明 |
|---------|-------------|------|
| 核心安全规则 | **Fail-Closed** | 黑名单、AML 必须阻断 |
| 业务风控规则 | 可配置 | 按场景决定是否放行 |
| 辅助规则 | **Fail-Open** | 评分、建议类规则 |

### 3. 环境差异策略

| 环境 | 策略 |
|-----|------|
| 开发/测试 | 可配置为 Fail-Open 或使用 Mock |
| 生产 | Fail-Closed，必须部署 Risk Service |

## 后果

### 正面
- 符合支付行业合规要求
- 核心安全规则始终生效
- 开发测试不受风控服务可用性影响

### 负面
- 生产环境需要保证风控服务高可用
- 需要实现风控服务健康检查机制

## 相关文档

- `docs/api/risk-service-integration.md` (待创建)
- `psp-dev` ConfigMap 需配置风控服务地址

## 技术债务关联

- **债务项**: 风控服务高可用架构
- **优先级**: P1（生产部署前必须解决）
- **负责人**: Infra + BE
